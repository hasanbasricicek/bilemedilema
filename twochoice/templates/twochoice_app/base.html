{% load static %}
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}bilemedilema{% endblock %}</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="{% block meta_description %}Ä°ki seÃ§enek arasÄ±nda kaldÄ±n mÄ±? Toplulukla birlikte karar ver! Anketler oluÅŸtur, oy ver, yorumla.{% endblock %}">
    <meta name="keywords" content="{% block meta_keywords %}anket, oylama, karar verme, topluluk, iki seÃ§enek, bilemedilema{% endblock %}">
    <meta name="author" content="bilemedilema">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="{% block canonical_url %}{{ request.build_absolute_uri }}{% endblock %}">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="{% block og_type %}website{% endblock %}">
    <meta property="og:url" content="{% block og_url %}{{ request.build_absolute_uri }}{% endblock %}">
    <meta property="og:title" content="{% block og_title %}bilemedilema - Ä°ki SeÃ§enek ArasÄ±nda Karar Ver{% endblock %}">
    <meta property="og:description" content="{% block og_description %}Ä°ki seÃ§enek arasÄ±nda kaldÄ±n mÄ±? Toplulukla birlikte karar ver! Anketler oluÅŸtur, oy ver, yorumla.{% endblock %}">
    <meta property="og:image" content="{% block og_image %}{% static 'images/og-default.png' %}{% endblock %}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="bilemedilema">
    <meta property="og:locale" content="tr_TR">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="{% block twitter_card %}summary_large_image{% endblock %}">
    <meta name="twitter:url" content="{% block twitter_url %}{{ request.build_absolute_uri }}{% endblock %}">
    <meta name="twitter:title" content="{% block twitter_title %}bilemedilema - Ä°ki SeÃ§enek ArasÄ±nda Karar Ver{% endblock %}">
    <meta name="twitter:description" content="{% block twitter_description %}Ä°ki seÃ§enek arasÄ±nda kaldÄ±n mÄ±? Toplulukla birlikte karar ver! Anketler oluÅŸtur, oy ver, yorumla.{% endblock %}">
    <meta name="twitter:image" content="{% block twitter_image %}{% static 'images/og-default.png' %}{% endblock %}">
    <meta name="twitter:creator" content="@bilemedilema">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#8B5CF6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="bilemedilema">
    <link rel="manifest" href="{% static 'manifest.json' %}">
    
    <link rel="icon" type="image/svg+xml" href="{% static 'favicon.svg' %}">
    <link rel="apple-touch-icon" href="{% static 'images/icon-192.png' %}">
    
    <!-- Premium UI Framework -->
    <link rel="stylesheet" href="{% static 'css/premium-ui.css' %}">
    
    <!-- Design Improvements CSS -->
    <link rel="stylesheet" href="{% static 'css/design-improvements.css' %}">
    <link rel="stylesheet" href="{% static 'css/landing-improvements.css' %}">
    <link rel="stylesheet" href="{% static 'css/themes.css' %}">
    <link rel="stylesheet" href="{% static 'css/poll-countdown.css' %}">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        (function preloadTheme() {
            try {
                const key = 'bilemedilema-theme';
                const stored = localStorage.getItem(key);
                const preferDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                const theme = stored === 'dark' || stored === 'light' ? stored : (preferDark ? 'dark' : 'light');
                if (theme === 'dark') {
                    document.documentElement.classList.add('dark');
                }
            } catch (e) {
                // ignore storage errors
            }
        })();
    </script>
    <style>
        /* Site genelinde kullanÄ±lan aÃ§Ä±k tema renk deÄŸiÅŸkenleri */
        :root {
            --background: oklch(0.99 0 0);
            --foreground: oklch(0.145 0 0);
            --card: oklch(1 0 0);
            --card-foreground: oklch(0.145 0 0);
            --popover: oklch(1 0 0);
            --popover-foreground: oklch(0.145 0 0);
            --primary: oklch(0.55 0.22 285);
            --primary-foreground: oklch(1 0 0);
            --secondary: oklch(0.96 0.01 285);
            --secondary-foreground: oklch(0.3 0 0);
            --muted: oklch(0.96 0.01 285);
            --muted-foreground: oklch(0.48 0 0);
            --accent: oklch(0.96 0.01 285);
            --accent-foreground: oklch(0.3 0 0);
            --destructive: oklch(0.577 0.245 27.325);
            --destructive-foreground: oklch(1 0 0);
            --border: oklch(0.9 0 0);
            --input: oklch(0.922 0 0);
            --ring: oklch(0.55 0.22 285);
            --poll-option-bg: oklch(0.98 0 0);
            --poll-option-border: oklch(0.9 0 0);
            --poll-option-hover: oklch(0.965 0.01 285);
            --poll-winner-glow: oklch(0.55 0.22 285 / 0.15);
            --poll-progress-bg: oklch(0.94 0 0);
            --chart-1: oklch(0.646 0.222 41.116);
            --chart-2: oklch(0.6 0.118 184.704);
            --chart-3: oklch(0.398 0.07 227.392);
            --chart-4: oklch(0.828 0.189 84.429);
            --chart-5: oklch(0.769 0.188 70.08);
            --logo-dot: #7C3AED;
            --radius: 0.75rem;
            --sidebar: oklch(0.985 0 0);
            --sidebar-foreground: oklch(0.145 0 0);
            --sidebar-primary: oklch(0.55 0.22 285);
            --sidebar-primary-foreground: oklch(1 0 0);
            --sidebar-accent: oklch(0.96 0.01 285);
            --sidebar-accent-foreground: oklch(0.3 0 0);
            --sidebar-border: oklch(0.922 0 0);
            --sidebar-ring: oklch(0.708 0 0);
        }

        /* KaranlÄ±k tema aktif olduÄŸunda gÃ¼ncellenen renk deÄŸiÅŸkenleri */
        .dark {
            --background: oklch(0.12 0.02 250);
            --foreground: oklch(0.94 0.02 250);
            --card: oklch(0.18 0.015 260);
            --card-foreground: oklch(0.96 0.02 260);
            --popover: oklch(0.18 0.015 260);
            --popover-foreground: oklch(0.96 0.02 260);
            --primary: oklch(0.7 0.24 285);
            --primary-foreground: oklch(0.99 0.01 285);
            --secondary: oklch(0.23 0.008 250);
            --secondary-foreground: oklch(0.9 0.01 250);
            --muted: oklch(0.22 0.01 250);
            --muted-foreground: oklch(0.72 0.02 250);
            --accent: oklch(0.25 0.02 310);
            --accent-foreground: oklch(0.96 0.02 310);
            --destructive: oklch(0.45 0.18 25);
            --destructive-foreground: oklch(0.98 0.01 25);
            --border: oklch(0.27 0.01 250);
            --input: oklch(0.28 0.01 250);
            --ring: oklch(0.64 0.24 285);
            --poll-option-bg: oklch(0.18 0.015 260);
            --poll-option-border: oklch(0.32 0.01 260);
            --poll-option-hover: oklch(0.28 0.015 260);
            --poll-winner-glow: oklch(0.7 0.24 285 / 0.3);
            --poll-progress-bg: oklch(0.24 0.01 260);
        }

        /* SayfanÄ±n temel tipografi ve arka plan ayarlarÄ± */
        body {
            font-family: "Geist", "Geist Fallback", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--background);
            color: var(--foreground);
        }

        /* Ãœst navigasyon ÅŸeridi */
        nav {
            background: var(--card) !important;
            border-bottom: 1px solid var(--border) !important;
            color: var(--foreground);
            box-shadow: 0 8px 30px oklch(0.145 0 0 / 0.05);
        }

        nav a,
        nav button,
        nav span,
        nav i {
            color: var(--muted-foreground) !important;
            transition: color 0.2s ease;
        }

        nav a:hover,
        nav button:hover {
            color: var(--foreground) !important;
        }

        /* Alt bilgi alanÄ± */
        footer {
            background-color: var(--card);
            border-top: 1px solid var(--border);
        }

        footer p {
            color: var(--muted-foreground) !important;
        }

        main.max-w-7xl {
            padding-top: 2.5rem;
            padding-bottom: 6rem;
        }

        @media (min-width: 640px) {
            main.max-w-7xl {
                padding-top: 3rem;
                padding-bottom: 3rem;
            }
        }

        .text-\[\#000000\] {
            color: var(--foreground) !important;
        }

        .text-\[\#666A73\],
        .text-\[\#7A7F92\] {
            color: var(--muted-foreground) !important;
        }

        .border-\[\#BFBFBF\],
        .border-\[\#B5BBCD\] {
            border-color: var(--border) !important;
        }

        .border-\[\#666A73\] {
            border-color: color-mix(in oklch, var(--border) 70%, var(--foreground)) !important;
        }

        .bg-\[\#F5F5F0\],
        .bg-\[\#F8F9F6\],
        .bg-\[\#F9FAFB\] {
            background-color: var(--background) !important;
        }

        .bg-white,
        .bg-white\/75,
        .bg-white\/95 {
            background-color: var(--card) !important;
            color: var(--card-foreground) !important;
        }

        .bg-\[\#000000\],
        .bg-\[\#666A73\] {
            background-color: var(--primary) !important;
            color: #ffffff !important;
        }

        .hover\:bg-\[\#666A73\]:hover,
        .hover\:bg-\[\#000000\]:hover {
            background-color: var(--foreground) !important;
            color: var(--primary-foreground) !important;
        }

        /* Kart tabanlÄ± bileÅŸenlerin paylaÅŸtÄ±ÄŸÄ± yÃ¼zey stili */
        .card-surface {
            background-color: var(--card);
            border: 1px solid var(--border);
            box-shadow: 0 18px 35px oklch(0.145 0 0 / 0.08);
            color: var(--card-foreground);
        }

        /* BaÅŸlÄ±kta gÃ¶sterilen logo + marka yazÄ±sÄ± */
        .logo-mark {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--foreground);
        }

        .logo-mark svg {
            width: 40px;
            height: 40px;
        }

        .logo-text {
            font-size: 1.25rem;
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        /* Mobil alt gezinme ÅŸeridi */
        .mobile-nav {
            background-color: var(--card) !important;
            border-top: 1px solid var(--border) !important;
        }

        .mobile-nav-link {
            color: var(--muted-foreground) !important;
            transition: color 0.2s ease, transform 0.2s ease;
            position: relative;
        }

        .mobile-nav-link:hover,
        .mobile-nav-link[aria-current="page"] {
            color: var(--primary) !important;
        }

        .mobile-nav-link.active-icon i,
        .mobile-nav-link.active-icon .theme-toggle-icon {
            color: var(--primary) !important;
        }

        #notifications-unread-badge-mobile {
            position: absolute;
            top: 2px;
            right: 8px;
            min-width: 18px;
            height: 18px;
            border-radius: 999px;
            background: var(--destructive);
            color: var(--destructive-foreground);
            font-size: 0.65rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0 4px;
        }

        .page-header {
            margin-bottom: 2.5rem;
            position: sticky;
            top: calc(64px + 0.75rem);
            z-index: 30;
            background: transparent;
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
        }

        @keyframes badgePulse {
            0% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(0, 0, 0, 0);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 0 0 6px rgba(0, 0, 0, 0);
            }
            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(0, 0, 0, 0);
            }
        }

        #notifications-unread-badge-mobile.active-badge {
            animation: badgePulse 1.75s ease-in-out infinite;
        }

        #fab-create-post {
            transition: transform 0.25s ease, opacity 0.25s ease;
        }

        .fab-hidden {
            transform: translateY(120%);
            opacity: 0;
            pointer-events: none;
        }

        .filter-pill {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1.25rem;
            border-radius: 999px;
            border: 1px solid var(--border);
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--muted-foreground);
            transition: background 0.2s ease, color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
        }

        .filter-pill:hover {
            color: var(--foreground);
            background: var(--muted);
            transform: translateY(-1px);
        }

        .filter-pill-active {
            background: var(--primary);
            color: var(--primary-foreground);
            border-color: var(--primary);
            box-shadow: 0 6px 14px oklch(0.145 0 0 / 0.12);
        }

        .filter-pill-active:hover {
            transform: translateY(-1px) scale(1.01);
        }

        .btn-outline {
            border: 1px solid var(--border);
            background: var(--card);
            color: var(--foreground);
        }

        .btn-outline:hover {
            background: var(--muted);
            border-color: var(--muted-foreground);
        }

        .btn-loading {
            position: relative;
            pointer-events: none;
            color: transparent !important;
        }

        .btn-loading::after {
            content: '';
            position: absolute;
            inset: 0;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            background: transparent;
            mask: none;
            animation: spin 0.75s linear infinite;
            border: 2px solid var(--primary-foreground);
            border-top-color: transparent;
            border-radius: 999px;
            width: 1.1rem;
            height: 1.1rem;
            margin: auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes softPulse {
            0% { box-shadow: 0 0 0 0 var(--poll-winner-glow); }
            70% { box-shadow: 0 0 0 12px color-mix(in oklch, var(--poll-winner-glow) 0%, transparent); }
            100% { box-shadow: 0 0 0 0 color-mix(in oklch, var(--poll-winner-glow) 0%, transparent); }
        }

        .animate-soft-pulse {
            animation: softPulse 2.5s ease-in-out infinite;
        }

        .poll-option {
            background: var(--poll-option-bg);
            border: 2px solid var(--poll-option-border);
            border-radius: calc(var(--radius) + 0.25rem);
            padding: 1.25rem;
            transition: all 0.2s ease;
            box-shadow: 0 1px 3px oklch(0.145 0 0 / 0.05);
            color: var(--foreground);
        }

        .poll-option:hover {
            background: var(--poll-option-hover);
            border-color: color-mix(in oklch, var(--primary) 40%, var(--poll-option-border));
            box-shadow: 0 4px 12px oklch(0.145 0 0 / 0.08);
            transform: translateY(-1px);
        }

        .poll-option-selected {
            background: color-mix(in oklch, var(--primary) 10%, var(--poll-option-bg));
            border-color: color-mix(in oklch, var(--primary) 70%, var(--poll-option-border));
            box-shadow: 0 0 0 3px color-mix(in oklch, var(--primary) 25%, transparent);
        }

        .poll-option-winner {
            border-color: color-mix(in oklch, var(--primary) 50%, var(--poll-option-border));
            background: color-mix(in oklch, var(--primary) 7%, var(--poll-option-bg));
            box-shadow: 0 0 0 3px var(--poll-winner-glow), 0 4px 12px oklch(0.145 0 0 / 0.1);
        }

        .poll-progress-bar {
            position: relative;
            overflow: hidden;
            border-radius: var(--radius);
            background: var(--poll-progress-bg);
            height: 0.65rem;
        }

        .poll-progress-bar-compact {
            height: 0.35rem;
        }

        .poll-progress-fill {
            height: 100%;
            transition: width 0.4s ease-out;
            background: linear-gradient(90deg, var(--primary), color-mix(in oklch, var(--primary) 70%, #ffffff));
            position: relative;
        }

        .poll-progress-fill::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(120deg, transparent, color-mix(in oklch, var(--primary) 30%, #fff), transparent);
            opacity: 0.25;
            animation: progressShimmer 1.2s linear infinite;
        }

        .poll-progress-fill.secondary {
            background: linear-gradient(90deg, var(--muted-foreground), color-mix(in oklch, var(--muted-foreground) 60%, #ffffff));
        }

        @keyframes progressShimmer {
            from { transform: translateX(-60%); }
            to { transform: translateX(60%); }
        }

        .poll-percentage {
            font-size: 1.875rem;
            font-weight: 800;
            font-variant-numeric: tabular-nums;
            text-shadow: 0 1px 2px oklch(0 0 0 / 0.1);
        }

        .poll-vote-count {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--muted-foreground);
        }

        .poll-card {
            background: var(--card);
            border-radius: calc(var(--radius) + 0.5rem);
            border: 1px solid var(--border);
            padding: 1.75rem;
            box-shadow: 0 2px 8px oklch(0.145 0 0 / 0.04), 0 1px 3px oklch(0.145 0 0 / 0.06);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .poll-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px oklch(0.145 0 0 / 0.08), 0 2px 6px oklch(0.145 0 0 / 0.1);
        }

        .poll-status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .poll-status-open {
            background: color-mix(in oklch, var(--primary) 15%, transparent);
            color: var(--primary);
            border: 1px solid color-mix(in oklch, var(--primary) 30%, transparent);
            animation: softPulse 3s ease-in-out infinite;
        }

        .poll-status-closed {
            background: color-mix(in oklch, var(--destructive) 12%, transparent);
            color: var(--destructive);
            border: 1px solid color-mix(in oklch, var(--destructive) 30%, transparent);
        }

        .poll-action-button {
            padding: 0.6rem 1.25rem;
            border-radius: var(--radius);
            font-weight: 600;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .poll-action-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px oklch(0.145 0 0 / 0.12);
        }

        .poll-tab {
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            font-weight: 600;
            color: var(--muted-foreground);
            transition: all 0.2s ease;
        }

        .poll-tab-active {
            background: var(--primary);
            color: var(--primary-foreground);
            box-shadow: 0 2px 6px oklch(0.145 0 0 / 0.15);
        }

        .poll-tab:not(.poll-tab-active):hover {
            background: var(--muted);
            color: var(--foreground);
        }

        .divider {
            height: 1px;
            background: var(--border);
            margin: 16px 0;
        }

        @keyframes tooltipFloat {
            from { transform: translateY(2px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        [data-poll-tooltip] {
            position: relative;
        }

        [data-poll-tooltip]:hover::after {
            content: attr(data-poll-tooltip);
            position: absolute;
            top: -2.25rem;
            right: 0;
            background: var(--foreground);
            color: var(--background);
            font-size: 0.7rem;
            padding: 0.25rem 0.6rem;
            border-radius: 999px;
            white-space: nowrap;
            animation: tooltipFloat 0.2s ease forwards;
        }

        .notification-ping {
            animation: softPulse 2s ease-in-out infinite;
        }

        .avatar-shell {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
            border-radius: 999px;
            overflow: hidden;
            background: var(--muted);
            font-weight: 600;
            color: var(--primary);
            transition: box-shadow 0.2s ease, transform 0.2s ease;
        }

        .avatar-shell:hover {
            box-shadow: 0 8px 20px oklch(0.145 0 0 / 0.15);
            transform: translateY(-1px);
        }

        .avatar-shell img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .avatar-shell .avatar-fallback {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            text-transform: uppercase;
            letter-spacing: 0.02em;
            font-size: 0.95rem;
            color: var(--primary);
            background: none;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .avatar-shell.show-fallback .avatar-fallback {
            opacity: 1;
        }

        .avatar-online-dot {
            position: absolute;
            right: 4px;
            bottom: 4px;
            width: 10px;
            height: 10px;
            border-radius: 999px;
            background: oklch(0.75 0.18 150);
            border: 2px solid var(--card);
            box-shadow: 0 0 6px oklch(0.75 0.18 150 / 0.7);
        }

        .post-card {
            transition: transform 0.25s ease, box-shadow 0.25s ease, border-color 0.25s ease;
        }

        .post-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 28px oklch(0.145 0 0 / 0.08);
            border-color: var(--border);
        }

        button,
        a {
            transition: color 0.2s ease, background 0.2s ease;
        }

        button:focus-visible,
        a:focus-visible {
            outline: 2px solid var(--ring);
            outline-offset: 3px;
        }

        /* Profil sayfasÄ±ndaki kahraman bloklarÄ± iÃ§in degrade arka plan */
        .profile-hero {
            background: linear-gradient(135deg,
                color-mix(in oklch, var(--background) 70%, var(--card)),
                color-mix(in oklch, var(--card) 90%, var(--foreground) 5%));
            border-bottom: 1px solid var(--border);
            color: var(--card-foreground);
        }

        .profile-avatar-shell {
            background: var(--card);
            border: 1px solid var(--border);
            box-shadow: 0 6px 18px oklch(0 0 0 / 0.12);
        }

        .profile-stat {
            background: color-mix(in oklch, var(--card) 85%, var(--background));
            border: 1px solid var(--border);
            border-radius: 1.5rem;
            padding: 1.25rem;
            text-align: center;
            box-shadow: 0 4px 12px oklch(0 0 0 / 0.08);
        }

        .profile-stat-value {
            font-size: 1.35rem;
            font-weight: 700;
            color: var(--foreground);
        }

        .profile-stat-label {
            font-size: 0.75rem;
            color: var(--muted-foreground);
        }

        .profile-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 1.5rem;
            box-shadow: 0 10px 25px oklch(0 0 0 / 0.07);
        }

        /* KaranlÄ±k/AydÄ±nlÄ±k seÃ§enekli dropdown butonu */
        .theme-toggle-menu {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            color: var(--foreground);
        }

        .theme-toggle-chip {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            border-radius: 999px;
            padding: 0.2rem 0.8rem;
            background: color-mix(in oklch, var(--primary) 18%, transparent);
            font-size: 0.75rem;
            font-weight: 600;
        }

        .theme-toggle-icon {
            width: 1.35rem;
            height: 1.35rem;
            border-radius: 999px;
            background: var(--foreground);
            color: var(--background);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
        }

        .mobile-nav {
            background-color: var(--card) !important;
            border-top: 1px solid var(--border) !important;
        }

        body.landing-page nav.app-main-nav {
            display: none;
        }
        
        /* Mobile Optimizations - Mobil Ä°yileÅŸtirmeleri */
        @media (max-width: 640px) {
            /* Font size adjustments */
            .poll-option .text-sm {
                font-size: 0.875rem;  /* 14px - Daha okunabilir */
            }
            
            .poll-percentage {
                font-size: 1.875rem !important;
            }
            
            .poll-vote-count {
                font-size: 0.75rem;  /* 12px */
            }
            
            .poll-card h2 {
                font-size: 1.125rem;  /* 18px - Daha bÃ¼yÃ¼k baÅŸlÄ±k */
            }
            
            .post-card h2 {
                font-size: 1.125rem;  /* 18px */
            }
            
            /* Kompakt padding mobilde */
            .poll-card {
                padding: 1rem !important;
            }
            
            .post-card {
                padding: 1rem !important;
            }
            
            .premium-card {
                padding: 1rem !important;
            }
            
            /* Avatar boyutu */
            .avatar-shell {
                width: 36px !important;
                height: 36px !important;
            }
            
            /* Touch Targets - Minimum 44x44px */
            button,
            a.inline-flex,
            .poll-option,
            .mobile-nav-link {
                min-height: 44px;
                min-width: 44px;
            }
            
            /* Hover efektlerini mobilde devre dÄ±ÅŸÄ± bÄ±rak */
            .poll-card:hover,
            .post-card:hover,
            .premium-card:hover {
                transform: none;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05), 0 1px 2px rgba(0, 0, 0, 0.03);
            }
            
            button:hover:not(:disabled),
            .btn:hover,
            a.inline-flex:hover {
                transform: none;
            }
            
            /* Mobil iÃ§in daha bÃ¼yÃ¼k input alanlarÄ± */
            input,
            textarea {
                font-size: 16px !important;  /* iOS zoom Ã¶nleme */
                padding: 12px 16px !important;
            }
            
            /* Emoji picker mobilde daha kÃ¼Ã§Ã¼k */
            .emoji-picker-panel {
                width: 280px !important;
                max-height: 300px !important;
            }
            
            .emoji-category {
                grid-template-columns: repeat(6, 1fr) !important;
            }
            
            .emoji-btn {
                font-size: 20px !important;
                padding: 6px !important;
            }
            
            /* Mobil spacing ayarlarÄ± */
            .space-y-6 > * + * {
                margin-top: 1rem !important;  /* Kartlar arasÄ± daha az boÅŸluk */
            }
            
            /* Bottom navigation iÃ§in alan bÄ±rak */
            main {
                padding-bottom: 5rem !important;
            }
        }
        
        /* Modern Card Shadows - YumuÅŸak GÃ¶lgeler */
        .premium-card,
        .poll-card,
        .post-card,
        .bg-white {
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05), 0 1px 2px rgba(0, 0, 0, 0.03);
            border: 1px solid #F3F4F6;
            transition: all 300ms cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Hover Effects - EtkileÅŸimli Kartlar (Sadece Desktop) */
        @media (min-width: 641px) {
            .poll-card:hover,
            .post-card:hover {
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08), 0 4px 10px rgba(0, 0, 0, 0.04);
                transform: translateY(-2px);
                border-color: #E5E7EB;
            }
            
            .premium-card:hover {
                box-shadow: 0 8px 20px rgba(0, 0, 0, 0.06);
            }
            
            button:hover:not(:disabled),
            .btn:hover,
            a.inline-flex:hover {
                transform: translateY(-1px);
            }
            
            .bg-\[\#000000\]:hover,
            .new-poll-button:hover {
                box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            }
        }
        
        /* Button Transitions */
        button,
        .btn,
        a.inline-flex {
            transition: all 200ms cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Active states (mobil iÃ§in) */
        button:active:not(:disabled),
        .btn:active,
        a.inline-flex:active {
            transform: scale(0.98);
            opacity: 0.9;
        }
        
        /* Spacing System - 8'in KatlarÄ± */
        :root {
            --space-1: 0.25rem;  /* 4px */
            --space-2: 0.5rem;   /* 8px */
            --space-3: 0.75rem;  /* 12px */
            --space-4: 1rem;     /* 16px */
            --space-5: 1.25rem;  /* 20px */
            --space-6: 1.5rem;   /* 24px */
            --space-8: 2rem;     /* 32px */
            --space-10: 2.5rem;  /* 40px */
            --space-12: 3rem;    /* 48px */
        }
        
        /* Card Padding - Daha Havadar */
        .poll-card,
        .post-card {
            padding: var(--space-6) !important;
        }
        
        .premium-card {
            padding: var(--space-5) !important;
        }
        
        /* Closed poll styling */
        .poll-card.poll-closed {
            opacity: 0.75;
            filter: grayscale(0.3);
        }
        
        .poll-card.poll-closed .poll-option {
            cursor: not-allowed;
            background-color: #f3f4f6 !important;
        }
        
        .poll-card.poll-closed:hover {
            transform: none;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        
        .poll-card.poll-closed .poll-progress-fill {
            background: linear-gradient(90deg, #9ca3af 0%, #6b7280 100%) !important;
        }
        
        .poll-card.poll-closed .poll-percentage {
            color: #6b7280 !important;
        }
        
        /* Bottom Navigation Active Tab Animation */
        .mobile-nav-link {
            position: relative;
            transition: all 0.3s ease;
        }
        
        .mobile-nav-link.active-icon::before {
            content: '';
            position: absolute;
            top: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid #8B5CF6;
            animation: bounce-arrow 0.6s ease-in-out;
        }
        
        @keyframes bounce-arrow {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-4px); }
        }
        
        .mobile-nav-link.active-icon {
            transform: scale(1.1);
        }
        
        /* Enhanced Progress Bars with Gradients */
        .poll-progress-fill {
            background: linear-gradient(90deg, #8B5CF6 0%, #EC4899 100%) !important;
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .poll-progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* Hover effect on poll cards */
        .poll-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .post-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }
        
        /* Badge Progress Bars */
        .progress-bar-modern {
            width: 100%;
            height: 8px;
            background: #E5E7EB;
            border-radius: 999px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);
        }
        
        .progress-fill-modern {
            height: 100%;
            background: linear-gradient(90deg, #8B5CF6 0%, #EC4899 50%, #F59E0B 100%);
            border-radius: 999px;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            box-shadow: 0 2px 8px rgba(139, 92, 246, 0.3);
        }
        
        .progress-fill-modern::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: progress-shimmer 2s infinite;
        }
        
        @keyframes progress-shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* Notification Badge Animation */
        .notification-badge {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .notification-badge .badge-count {
            position: absolute;
            top: -8px;
            right: -8px;
            min-width: 20px;
            height: 20px;
            padding: 0 6px;
            background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
            color: white;
            font-size: 11px;
            font-weight: bold;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.4);
            animation: badge-pulse 2s infinite;
        }
        
        @keyframes badge-pulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 2px 8px rgba(239, 68, 68, 0.4);
            }
            50% {
                transform: scale(1.1);
                box-shadow: 0 4px 12px rgba(239, 68, 68, 0.6);
            }
        }
        
        .notification-badge .badge-count.new {
            animation: badge-bounce 0.6s ease-in-out;
        }
        
        @keyframes badge-bounce {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.3); }
            50% { transform: scale(0.9); }
            75% { transform: scale(1.1); }
        }
        
        /* New Poll Button with Gradient & Glow */
        .new-poll-button {
            background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .new-poll-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }
        
        .new-poll-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(139, 92, 246, 0.6);
        }
        
        .new-poll-button:hover::before {
            left: 100%;
        }
        
        .new-poll-button:active {
            transform: translateY(0);
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    {% block extra_head %}{% endblock %}
</head>
<body data-theme="{{ theme|default:'light' }}" class="min-h-screen {{ body_class|default:'' }}">
    <nav class="bg-white/95 backdrop-blur border-b border-[#BFBFBF] sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="{% url 'home' %}" class="logo-mark" aria-label="bilemedilema ana sayfa">
                        <svg viewBox="0 0 80 80" fill="none" role="img" aria-hidden="true">
                            <path
                                d="M25 20 L25 60 L45 60 C52 60 56 56 56 50 C56 46 54 43 50 42 C54 41 56 38 56 34 C56 28 52 20 45 20 L25 20 Z"
                                stroke="currentColor"
                                stroke-width="4"
                                fill="none"
                                stroke-linejoin="round"
                            />
                            <circle cx="43" cy="32" r="3" fill="var(--logo-dot)"></circle>
                            <circle cx="43" cy="48" r="3" fill="var(--logo-dot)"></circle>
                        </svg>
                        <span class="logo-text">bilemedilema</span>
                    </a>
                </div>
                
                <div class="hidden sm:flex items-center space-x-4">
                    {% if user.is_authenticated %}
                        {% if not user.is_staff and not user.is_superuser %}
                            <a id="nav-feedback" href="{% url 'create_feedback' %}" class="text-[#000000] hover:text-[#666A73] px-3 py-2 rounded-xl text-sm font-medium transition duration-200" title="Geri Bildirim">
                                <i class="fas fa-comment-dots mr-1"></i>Geri Bildirim
                            </a>
                        {% endif %}
                        <a href="{% url 'home' %}" class="text-[#000000] hover:text-[#666A73] px-3 py-2 rounded-xl text-sm font-medium transition duration-200">
                            <i class="fas fa-home mr-1"></i>Ana Sayfa
                        </a>
                        <a href="{% url 'search' %}" class="text-[#000000] hover:text-[#666A73] px-3 py-2 rounded-xl text-sm font-medium transition duration-200" title="Ara">
                            <i class="fas fa-search mr-1"></i>Ara
                        </a>
                        <a id="nav-create-post" href="{% url 'create_post' %}" class="new-poll-button inline-flex items-center gap-2 text-white px-4 py-2.5 rounded-xl text-sm font-semibold" title="Yeni Anket">
                            <i class="fas fa-plus mr-1"></i>Yeni Anket
                        </a>

                        <a id="nav-notifications-desktop" href="{% url 'notifications' %}" class="notification-badge text-[#000000] hover:text-[#666A73] px-3 py-2 rounded-xl text-sm font-medium transition duration-200" title="Bildirimler">
                            <i class="fas fa-bell text-[15px]"></i>
                            <span id="notifications-unread-badge-desktop" class="badge-count {% if not notifications_unread_count or notifications_unread_count <= 0 %}hidden{% endif %}">
                                {{ notifications_unread_count }}
                            </span>
                        </a>
                        
                        <button id="theme-toggle" type="button" class="text-[#000000] hover:text-[#666A73] px-3 py-2 rounded-xl text-sm font-medium transition duration-200 flex items-center gap-2" title="Tema DeÄŸiÅŸtir">
                            <span>ðŸŒ™</span>
                            <span class="hidden sm:inline">Tema</span>
                        </button>
                        
                        {% if user.is_staff or user.is_superuser %}
                            <a href="{% url 'moderate_posts' %}" class="text-[#000000] hover:text-[#666A73] px-3 py-2 rounded-xl text-sm font-medium transition duration-200">
                                <i class="fas fa-shield-alt mr-1"></i>Moderasyon
                            </a>
                            <a href="{% url 'moderate_reports' %}" class="text-[#000000] hover:text-[#666A73] px-3 py-2 rounded-xl text-sm font-medium transition duration-200">
                                <i class="fas fa-flag mr-1"></i>Raporlar
                            </a>
                            <a href="{% url 'moderate_users' %}" class="text-[#000000] hover:text-[#666A73] px-3 py-2 rounded-xl text-sm font-medium transition duration-200">
                                <i class="fas fa-users mr-1"></i>KullanÄ±cÄ±lar
                            </a>
                            <a href="{% url 'moderation_logs' %}" class="text-[#000000] hover:text-[#666A73] px-3 py-2 rounded-xl text-sm font-medium transition duration-200">
                                <i class="fas fa-clipboard-list mr-1"></i>Loglar
                            </a>
                            <a href="{% url 'moderate_feedback' %}" class="text-[#000000] hover:text-[#666A73] px-3 py-2 rounded-xl text-sm font-medium transition duration-200">
                                <i class="fas fa-comment-dots mr-1"></i>Geri Bildirimler
                            </a>
                        {% endif %}
                        
                        <div class="relative group">
                            <button id="nav-user-menu" type="button" class="flex items-center space-x-2 text-[#000000] hover:text-[#666A73] transition duration-200">
                                <i class="fas fa-user-circle text-2xl"></i>
                                <div class="flex items-center space-x-1">
                                    <span class="font-medium">{{ user.username }}</span>
                                    {% if user.is_superuser %}
                                        <span class="bg-gradient-to-r from-[#B33F00] to-[#666A73] text-white text-xs font-bold px-2 py-0.5 rounded-full">
                                            <i class="fas fa-crown"></i> YÃ¶netici
                                        </span>
                                    {% elif user.is_staff %}
                                        <span class="bg-gradient-to-r from-[#0B5275] to-[#666A73] text-white text-xs font-bold px-2 py-0.5 rounded-full">
                                            <i class="fas fa-shield-alt"></i> ModeratÃ¶r
                                        </span>
                                    {% endif %}
                                </div>
                                <i class="fas fa-chevron-down text-xs"></i>
                            </button>
                            <div class="absolute right-0 top-full pt-2 w-48 hidden group-hover:block group-focus-within:block z-50">
                                <div class="glass-card py-2">
                                    <a href="{% url 'user_profile' user.username %}" class="block px-4 py-2 text-[#000000] hover:bg-[#F8F9F6] transition duration-200">
                                        <i class="fas fa-user mr-2"></i>Profilim
                                    </a>
                                    <a href="{% url 'notification_settings' %}" class="block px-4 py-2 text-[#000000] hover:bg-[#F8F9F6] transition duration-200">
                                        <i class="fas fa-bell mr-2"></i>Bildirim AyarlarÄ±
                                    </a>
                                    <a href="{% url 'create_feedback' %}" class="block px-4 py-2 text-[#000000] hover:bg-[#F8F9F6] transition duration-200">
                                        <i class="fas fa-comment-dots mr-2"></i>Geri Bildirim
                                    </a>
                                    <a href="{% url 'bookmarks_list' %}" class="block px-4 py-2 text-[#000000] hover:bg-[#F8F9F6] transition duration-200">
                                        <i class="fas fa-bookmark mr-2"></i>Favorilerim
                                    </a>
                                    <a href="{% url 'logout' %}" class="block px-4 py-2 text-[#000000] hover:bg-[#F8F9F6] transition duration-200">
                                        <i class="fas fa-sign-out-alt mr-2"></i>Ã‡Ä±kÄ±ÅŸ Yap
                                    </a>
                                </div>
                            </div>
                        </div>
                    {% else %}
                        <a href="{% url 'login' %}" class="text-[#000000] hover:text-[#666A73] px-3 py-2 rounded-xl text-sm font-medium transition duration-200">
                            GiriÅŸ Yap
                        </a>
                        <a href="{% url 'register' %}" class="bg-[#666A73] hover:bg-[#000000] text-white px-4 py-2 rounded-xl transition duration-200 font-medium">
                            KayÄ±t Ol
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>

    {% if messages %}
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-4">
            {% for message in messages %}
                <div class="{% if message.tags == 'error' %}bg-[#B33F00]/10 border-[#B33F00] text-[#000000]{% elif message.tags == 'success' %}bg-[#0B5275]/10 border-[#0B5275] text-[#000000]{% else %}bg-[#666A73]/10 border-[#666A73] text-[#000000]{% endif %} border px-4 py-3 rounded-lg mb-4 flex items-center justify-between">
                    <span>{{ message }}</span>
                    <button onclick="this.parentElement.remove()" class="ml-4">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            {% endfor %}
        </div>

        {% if not user.is_staff and not user.is_superuser %}
            <div id="onboarding-tour" class="fixed inset-0 z-[70] hidden" aria-hidden="true">
                <div class="absolute inset-0 bg-black/60"></div>
                <div id="onboarding-spotlight" class="absolute rounded-2xl ring-4 ring-white/70 pointer-events-none"></div>
                <div id="onboarding-card" class="absolute max-w-sm bg-white border border-[#BFBFBF] rounded-2xl shadow-xl p-4">
                    <div class="flex items-start justify-between gap-3">
                        <div>
                            <p id="onboarding-step" class="text-xs font-semibold text-[#666A73]"></p>
                            <p id="onboarding-title" class="mt-1 text-base font-semibold text-[#000000]"></p>
                        </div>
                        <button type="button" class="text-[#666A73] hover:text-[#000000]" aria-label="Kapat" data-onboarding-skip>
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <p id="onboarding-text" class="mt-2 text-sm text-[#666A73]"></p>
                    <div class="mt-4 flex items-center justify-between">
                        <button type="button" class="text-sm font-semibold text-[#666A73] hover:text-[#000000] transition duration-200" data-onboarding-back>Geri</button>
                        <div class="flex items-center gap-2">
                            <button type="button" class="text-sm font-semibold px-3 py-2 rounded-xl border border-[#BFBFBF] bg-white text-[#000000] hover:bg-[#F8F9F6] transition duration-200" data-onboarding-skip>GeÃ§</button>
                            <button type="button" class="text-sm font-semibold px-4 py-2 rounded-xl bg-[#000000] text-white hover:bg-[#666A73] transition duration-200" data-onboarding-next>Ä°leri</button>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    {% endif %}

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pb-24 sm:pb-8">
        {% block content %}{% endblock %}
    </main>

    <div id="toast" class="hidden fixed bottom-4 left-1/2 -translate-x-1/2 z-50">
        <div id="toast-inner" class="bg-[#666A73] text-white text-sm font-medium px-4 py-3 rounded-xl shadow-lg border border-[#000000]"></div>
    </div>

    {% if user.is_authenticated %}
        <a id="fab-create-post" href="{% url 'create_post' %}" class="sm:hidden fixed bottom-20 right-4 z-[55] w-14 h-14 rounded-full bg-[#000000] text-white shadow-lg border border-white/10 flex items-center justify-center hover:bg-[#666A73] transition duration-200" aria-label="Yeni Anket">
            <i class="fas fa-plus text-[18px]"></i>
        </a>
    {% endif %}

    <div class="sm:hidden fixed bottom-0 left-0 right-0 z-50 bg-white/95 backdrop-blur border-t border-[#BFBFBF]">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center h-16 text-xs font-semibold text-[#666A73]">
                <a href="{% url 'home' %}" class="mobile-nav-link flex flex-col items-center justify-center gap-1 {% if request.resolver_match.url_name == 'home' %}active-icon text-[#8B5CF6]{% endif %}" {% if request.resolver_match.url_name == 'home' %}aria-current="page"{% endif %}>
                    <i class="fas fa-home text-lg"></i>
                    Ana Sayfa
                </a>
                <a href="{% url 'search' %}" class="mobile-nav-link flex flex-col items-center justify-center gap-1 {% if request.resolver_match.url_name == 'search' %}active-icon text-[#8B5CF6]{% endif %}" {% if request.resolver_match.url_name == 'search' %}aria-current="page"{% endif %}>
                    <i class="fas fa-search text-lg"></i>
                    Ara
                </a>
                <a href="{% url 'notifications' %}" class="mobile-nav-link flex flex-col items-center justify-center gap-1 {% if request.resolver_match.url_name == 'notifications' %}active-icon text-[#8B5CF6]{% endif %}" {% if request.resolver_match.url_name == 'notifications' %}aria-current="page"{% endif %}>
                    <i class="fas fa-bell text-lg"></i>
                    Bildirim
                </a>
                <a href="{% url 'create_feedback' %}" class="mobile-nav-link flex flex-col items-center justify-center gap-1 {% if request.resolver_match.url_name == 'create_feedback' %}active-icon text-[#8B5CF6]{% endif %}" {% if request.resolver_match.url_name == 'create_feedback' %}aria-current="page"{% endif %}>
                    <i class="fas fa-comment-dots text-lg"></i>
                    Geri Bildirim
                </a>
                {% if user.is_authenticated %}
                    <a href="{% url 'user_profile' user.username %}" class="mobile-nav-link flex flex-col items-center justify-center gap-1 {% if request.resolver_match.url_name == 'user_profile' %}active-icon text-[#8B5CF6]{% endif %}" {% if request.resolver_match.url_name == 'user_profile' %}aria-current="page"{% endif %}>
                        <i class="fas fa-user text-lg"></i>
                        Profil
                    </a>
                {% else %}
                    <a href="{% url 'login' %}" class="mobile-nav-link flex flex-col items-center justify-center gap-1 {% if request.resolver_match.url_name == 'login' %}active-icon text-[#8B5CF6]{% endif %}" {% if request.resolver_match.url_name == 'login' %}aria-current="page"{% endif %}>
                        <i class="fas fa-user text-lg"></i>
                        GiriÅŸ
                    </a>
                {% endif %}
            </div>
        </div>
    </div>

    <footer class="bg-white border-t border-[#BFBFBF] mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <p class="text-center text-[#666A73] text-sm">
                &copy; 2024 bilemedilema. TÃ¼m haklarÄ± saklÄ±dÄ±r.
            </p>
        </div>
    </footer>

    {% if user.is_authenticated %}
        <div id="welcome-modal" class="fixed inset-0 z-[60] hidden" aria-hidden="true">
            <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" data-welcome-close></div>
            <div class="relative mx-auto max-w-3xl px-4 sm:px-6 lg:px-8 h-full flex items-center justify-center">
                <div class="bg-white w-full rounded-3xl shadow-2xl overflow-hidden transform transition-all" style="animation: modalSlideIn 0.3s ease-out;">
                    <!-- Gradient Header -->
                    <div class="relative bg-gradient-to-r from-purple-600 via-pink-500 to-purple-600 p-8 text-white">
                        <div class="absolute top-4 right-4">
                            <button type="button" class="text-white/80 hover:text-white transition-colors" aria-label="Kapat" data-welcome-close>
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        <div class="text-center">
                            <div class="inline-flex items-center justify-center w-20 h-20 bg-white/20 backdrop-blur-sm rounded-full mb-4">
                                <i class="fas fa-rocket text-4xl"></i>
                            </div>
                            <h2 class="text-3xl font-bold mb-2">HoÅŸ Geldin! ðŸŽ‰</h2>
                            <p class="text-white/90 text-lg">KararsÄ±zlÄ±klarÄ±na son vermeye hazÄ±r mÄ±sÄ±n?</p>
                        </div>
                    </div>

                    <!-- Content -->
                    <div class="p-6 sm:p-8">
                        <!-- Beta Bilgisi -->
                        <div class="bg-gradient-to-r from-purple-50 to-pink-50 border border-purple-200 rounded-2xl p-5 mb-6">
                            <div class="flex items-start gap-3">
                                <div class="flex-shrink-0 w-10 h-10 bg-gradient-to-r from-purple-600 to-pink-500 rounded-full flex items-center justify-center">
                                    <i class="fas fa-flask text-white"></i>
                                </div>
                                <div class="flex-1">
                                    <h3 class="font-semibold text-gray-900 mb-1">Beta SÃ¼rÃ¼mÃ¼ndesin!</h3>
                                    <p class="text-sm text-gray-600 leading-relaxed">
                                        Bu uygulama seninle birlikte geliÅŸiyor. Her geri bildirimin, uygulamanÄ±n geleceÄŸini ÅŸekillendiriyor. ðŸš€
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Ã–zellikler -->
                        <h3 class="font-semibold text-gray-900 mb-4 flex items-center gap-2">
                            <i class="fas fa-star text-yellow-500"></i>
                            Neler Yapabilirsin?
                        </h3>
                        <div class="grid gap-3 mb-6">
                            <div class="flex items-start gap-3 p-3 rounded-xl hover:bg-gray-50 transition-colors">
                                <div class="flex-shrink-0 w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-poll text-purple-600"></i>
                                </div>
                                <div class="flex-1">
                                    <h4 class="font-medium text-gray-900 text-sm">Anket OluÅŸtur</h4>
                                    <p class="text-xs text-gray-600">KararsÄ±z kaldÄ±ÄŸÄ±nda hÄ±zlÄ±ca anket aÃ§, insanlarÄ±n oylarÄ±yla karar ver</p>
                                </div>
                            </div>
                            <div class="flex items-start gap-3 p-3 rounded-xl hover:bg-gray-50 transition-colors">
                                <div class="flex-shrink-0 w-8 h-8 bg-pink-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-comments text-pink-600"></i>
                                </div>
                                <div class="flex-1">
                                    <h4 class="font-medium text-gray-900 text-sm">Yorum Yap & Emoji Ekle</h4>
                                    <p class="text-xs text-gray-600">Anketlere yorum yap, emoji picker ile duygularÄ±nÄ± ifade et ðŸ˜Š</p>
                                </div>
                            </div>
                            <div class="flex items-start gap-3 p-3 rounded-xl hover:bg-gray-50 transition-colors">
                                <div class="flex-shrink-0 w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-share-alt text-blue-600"></i>
                                </div>
                                <div class="flex-1">
                                    <h4 class="font-medium text-gray-900 text-sm">PaylaÅŸ</h4>
                                    <p class="text-xs text-gray-600">Anketleri arkadaÅŸlarÄ±nla paylaÅŸ, daha fazla oy topla</p>
                                </div>
                            </div>
                            <div class="flex items-start gap-3 p-3 rounded-xl hover:bg-gray-50 transition-colors">
                                <div class="flex-shrink-0 w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-bell text-green-600"></i>
                                </div>
                                <div class="flex-1">
                                    <h4 class="font-medium text-gray-900 text-sm">Bildirimler</h4>
                                    <p class="text-xs text-gray-600">Oylar, yorumlar ve yanÄ±tlar anÄ±nda bildirim olarak gelsin</p>
                                </div>
                            </div>
                            <div class="flex items-start gap-3 p-3 rounded-xl hover:bg-gray-50 transition-colors">
                                <div class="flex-shrink-0 w-8 h-8 bg-yellow-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-trophy text-yellow-600"></i>
                                </div>
                                <div class="flex-1">
                                    <h4 class="font-medium text-gray-900 text-sm">Rozet Kazan</h4>
                                    <p class="text-xs text-gray-600">Aktif olarak katÄ±l, rozetler kazan ve seviyeni yÃ¼kselt</p>
                                </div>
                            </div>
                            <div class="flex items-start gap-3 p-3 rounded-xl hover:bg-gray-50 transition-colors">
                                <div class="flex-shrink-0 w-8 h-8 bg-indigo-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-bookmark text-indigo-600"></i>
                                </div>
                                <div class="flex-1">
                                    <h4 class="font-medium text-gray-900 text-sm">Kaydet & Takip Et</h4>
                                    <p class="text-xs text-gray-600">Ä°lgini Ã§eken anketleri kaydet, sonuÃ§larÄ± takip et</p>
                                </div>
                            </div>
                        </div>

                        <!-- Geri Bildirim Ã‡aÄŸrÄ±sÄ± -->
                        <div class="bg-gradient-to-r from-gray-50 to-gray-100 border border-gray-200 rounded-2xl p-5">
                            <div class="flex items-center gap-3 mb-3">
                                <i class="fas fa-heart text-red-500 text-xl"></i>
                                <h3 class="font-semibold text-gray-900">Fikirlerini PaylaÅŸ</h3>
                            </div>
                            <p class="text-sm text-gray-600 leading-relaxed mb-3">
                                BeÄŸendiklerin, beÄŸenmediklerin, aklÄ±na gelen her fikir deÄŸerli! Geri bildirimlerinle bu uygulamayÄ± birlikte ÅŸekillendirelim.
                            </p>
                            <a href="{% url 'create_feedback' %}" class="inline-flex items-center gap-2 text-sm font-semibold text-purple-600 hover:text-purple-700 transition-colors">
                                <i class="fas fa-comment-dots"></i>
                                Geri Bildirim GÃ¶nder
                                <i class="fas fa-arrow-right text-xs"></i>
                            </a>
                        </div>
                    </div>

                    <!-- Footer -->
                    <div class="px-6 sm:px-8 pb-6 sm:pb-8">
                        <button type="button" class="w-full bg-gradient-to-r from-purple-600 to-pink-500 text-white px-6 py-3.5 rounded-xl text-base font-semibold hover:from-purple-700 hover:to-pink-600 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-[1.02]" data-welcome-close>
                            <i class="fas fa-check-circle mr-2"></i>
                            Hadi BaÅŸlayalÄ±m!
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <style>
            @keyframes modalSlideIn {
                from {
                    opacity: 0;
                    transform: translateY(-20px) scale(0.95);
                }
                to {
                    opacity: 1;
                    transform: translateY(0) scale(1);
                }
            }
        </style>

        <div id="notification-toast" class="fixed top-4 right-4 z-[65] hidden">
            <div class="bg-white border border-[#BFBFBF] shadow-lg rounded-2xl px-4 py-3 max-w-sm">
                <div class="flex items-start gap-3">
                    <div class="mt-0.5 text-[#000000]">
                        <i class="fas fa-bell"></i>
                    </div>
                    <div class="flex-1">
                        <p class="text-sm font-semibold text-[#000000]">Yeni bildirim</p>
                        <p id="notification-toast-text" class="text-sm text-[#666A73]">Bildirimlerin gÃ¼ncellendi.</p>
                        <a id="notification-toast-link" href="{% url 'notifications' %}" class="inline-block mt-2 text-sm font-semibold text-[#0B5275] hover:text-[#000000] transition duration-200">GÃ¶rÃ¼ntÃ¼le</a>
                    </div>
                    <button type="button" class="text-[#666A73] hover:text-[#000000]" aria-label="Kapat" data-toast-close>
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
        </div>
    {% endif %}

    {% if user.is_authenticated %}
    <script>
        (function() {
            const endpoint = "{% url 'notifications_unread_count_api' %}";
            const latestEndpoint = "{% url 'notifications_latest_unread_api' %}";
            const badgeDesktop = document.getElementById('notifications-unread-badge-desktop');
            const badgeMobile = document.getElementById('notifications-unread-badge-mobile');
            const toast = document.getElementById('notification-toast');
            const toastText = document.getElementById('notification-toast-text');
            const toastLink = document.getElementById('notification-toast-link');
            const isNotificationsPage = "{{ request.resolver_match.url_name }}" === "notifications";
            let lastCount = Number("{{ notifications_unread_count|default:0 }}") || 0;
            let toastTimer = null;

            function showToast(message) {
                if (!toast || isNotificationsPage) return;
                if (toastText && message) toastText.textContent = message;
                toast.classList.remove('hidden');

                if (toastTimer) {
                    clearTimeout(toastTimer);
                    toastTimer = null;
                }
                toastTimer = setTimeout(() => {
                    toast.classList.add('hidden');
                }, 4500);
            }

            function hideToast() {
                if (!toast) return;
                toast.classList.add('hidden');
                if (toastTimer) {
                    clearTimeout(toastTimer);
                    toastTimer = null;
                }
            }

            if (toast) {
                toast.querySelectorAll('[data-toast-close]').forEach((btn) => {
                    btn.addEventListener('click', hideToast);
                });
            }

            function applyCount(count) {
                const elts = [badgeDesktop, badgeMobile].filter(Boolean);
                elts.forEach((el) => {
                    if (count > 0) {
                        el.textContent = String(count);
                        el.classList.remove('hidden');
                        el.classList.add('active-badge');
                    } else {
                        el.textContent = '';
                        el.classList.add('hidden');
                        el.classList.remove('active-badge');
                    }
                });
            }

            async function refreshUnreadCount() {
                try {
                    const resp = await fetch(endpoint, {
                        method: 'GET',
                        headers: { 'X-Requested-With': 'XMLHttpRequest' },
                        credentials: 'same-origin',
                    });
                    if (!resp.ok) return;
                    const data = await resp.json();
                    const count = Number(data && data.count);
                    if (!Number.isNaN(count)) {
                        if (count > lastCount) {
                            try {
                                const resp2 = await fetch(latestEndpoint, {
                                    method: 'GET',
                                    headers: { 'X-Requested-With': 'XMLHttpRequest' },
                                    credentials: 'same-origin',
                                });
                                if (resp2.ok) {
                                    const data2 = await resp2.json();
                                    if (toastLink && data2 && data2.url) {
                                        toastLink.setAttribute('href', data2.url);
                                    }
                                    const msg = (data2 && data2.text) ? String(data2.text) : 'Yeni bir bildirimin var.';
                                    showToast(msg);
                                } else {
                                    showToast('Yeni bir bildirimin var.');
                                }
                            } catch (e) {
                                showToast('Yeni bir bildirimin var.');
                            }
                        }
                        applyCount(count);
                        lastCount = count;
                    }
                } catch (e) {
                }
            }

            refreshUnreadCount();
            setInterval(refreshUnreadCount, 10000);
        })();
    </script>
    {% endif %}

    <script>
        (function() {
            function showPageToast(message) {
                try {
                    const toast = document.getElementById('toast');
                    const inner = document.getElementById('toast-inner');
                    if (!toast || !inner) return false;
                    inner.textContent = message;
                    toast.classList.remove('hidden');
                    clearTimeout(window.__toastTimer);
                    window.__toastTimer = setTimeout(() => {
                        toast.classList.add('hidden');
                    }, 2200);
                    return true;
                } catch (e) {
                    return false;
                }
            }

            async function shareLink(url, title, text) {
                const absUrl = (url && url.startsWith('/')) ? (window.location.origin + url) : url;
                const payload = { title: title || document.title, url: absUrl };
                if (text) payload.text = String(text);

                if (navigator.share) {
                    try {
                        await navigator.share(payload);
                        showPageToast('PaylaÅŸÄ±ldÄ±.');
                        return;
                    } catch (e) {
                    }
                }

                try {
                    if (navigator.clipboard && navigator.clipboard.writeText) {
                        const combined = [text ? String(text) : '', absUrl].filter(Boolean).join('\n');
                        await navigator.clipboard.writeText(combined);
                        if (!showPageToast(text ? 'PaylaÅŸÄ±m metni kopyalandÄ±.' : 'Link panoya kopyalandÄ±.')) {
                            alert(text ? 'PaylaÅŸÄ±m metni kopyalandÄ±.' : 'Link panoya kopyalandÄ±.');
                        }
                        return;
                    }
                } catch (e) {
                }

                try {
                    window.prompt('Linki kopyala:', absUrl);
                } catch (e) {
                }
            }

            document.addEventListener('click', (e) => {
                const btn = e.target.closest('[data-share-url]');
                if (!btn) return;
                e.preventDefault();
                const url = btn.getAttribute('data-share-url') || '';
                const title = btn.getAttribute('data-share-title') || '';
                const text = btn.getAttribute('data-share-text') || '';
                if (!url) return;
                shareLink(url, title, text);
            });
        })();
    </script>

    {% if show_welcome_popup %}
    <script>
        (function() {
            const modal = document.getElementById('welcome-modal');
            if (!modal) return;

            const isModerator = "{{ user.is_staff|yesno:'1,0' }}" === "1" || "{{ user.is_superuser|yesno:'1,0' }}" === "1";
            const username = "{{ user.username|escapejs }}";
            const tourKey = `onboarding_done_${username}`;
            const tourRoot = document.getElementById('onboarding-tour');

            function closeModal() {
                modal.classList.add('hidden');
                modal.setAttribute('aria-hidden', 'true');
                document.body.classList.remove('overflow-hidden');

                try {
                    if (!isModerator && tourRoot && username && !localStorage.getItem(tourKey)) {
                        startOnboardingTour();
                    }
                } catch (e) {
                }
            }

            function openModal() {
                modal.classList.remove('hidden');
                modal.setAttribute('aria-hidden', 'false');
                document.body.classList.add('overflow-hidden');
            }

            modal.querySelectorAll('[data-welcome-close]').forEach((btn) => {
                btn.addEventListener('click', closeModal);
            });

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') closeModal();
            });

            function startOnboardingTour() {
                if (!tourRoot) return;

                const spotlight = document.getElementById('onboarding-spotlight');
                const card = document.getElementById('onboarding-card');
                const stepEl = document.getElementById('onboarding-step');
                const titleEl = document.getElementById('onboarding-title');
                const textEl = document.getElementById('onboarding-text');
                const btnNext = tourRoot.querySelector('[data-onboarding-next]');
                const btnBack = tourRoot.querySelector('[data-onboarding-back]');
                const btnSkips = tourRoot.querySelectorAll('[data-onboarding-skip]');

                const steps = [
                    {
                        getTarget: () => document.getElementById('nav-create-post') || document.getElementById('fab-create-post'),
                        title: 'Yeni anket oluÅŸtur',
                        text: 'KararsÄ±z kaldÄ±ÄŸÄ±nda sorunu paylaÅŸ ve anket aÃ§. Ä°nsanlarÄ±n oylarÄ±yla karar ver!',
                    },
                    {
                        getTarget: () => document.querySelector('.js-share-post'),
                        title: 'PaylaÅŸ',
                        text: 'Bir gÃ¶nderiyi arkadaÅŸlarÄ±nla paylaÅŸmak iÃ§in buradaki paylaÅŸ butonunu kullanabilirsin.',
                    },
                    {
                        getTarget: () => document.getElementById('nav-notifications-desktop') || document.getElementById('nav-notifications-mobile'),
                        title: 'Bildirimlerini takip et',
                        text: 'Oylar, yorumlar ve geri bildirim yanÄ±tlarÄ± burada toplanÄ±r.',
                    },
                    {
                        getTarget: () => document.getElementById('nav-feedback') || document.getElementById('nav-feedback-mobile'),
                        title: 'Geri bildirim gÃ¶nder',
                        text: 'Beta sÃ¼rÃ¼mdeyiz. Fikirlerini paylaÅŸtÄ±kÃ§a uygulama seninle birlikte geliÅŸiyor.',
                    },
                    {
                        getTarget: () => document.getElementById('nav-user-menu'),
                        title: 'Bildirim ayarlarÄ±nÄ± yÃ¶net',
                        text: 'SaÄŸ Ã¼stteki menÃ¼den â€œBildirim AyarlarÄ±â€ sayfasÄ±na gidip hangi bildirimleri almak istediÄŸini seÃ§ebilirsin.',
                    },
                ];

                let idx = 0;

                function finish() {
                    tourRoot.classList.add('hidden');
                    tourRoot.setAttribute('aria-hidden', 'true');
                    document.body.classList.remove('overflow-hidden');
                    try { localStorage.setItem(tourKey, '1'); } catch (e) {}
                }

                function place() {
                    const s = steps[idx];
                    const t = s.getTarget();
                    if (!t) {
                        finish();
                        return;
                    }

                    const r = t.getBoundingClientRect();
                    const pad = 10;
                    const top = Math.max(r.top - pad, 8);
                    const left = Math.max(r.left - pad, 8);
                    const width = Math.min(r.width + pad * 2, window.innerWidth - left - 8);
                    const height = Math.min(r.height + pad * 2, window.innerHeight - top - 8);

                    spotlight.style.top = `${top}px`;
                    spotlight.style.left = `${left}px`;
                    spotlight.style.width = `${width}px`;
                    spotlight.style.height = `${height}px`;

                    const cardWidth = Math.min(380, window.innerWidth - 16);
                    card.style.width = `${cardWidth}px`;

                    const belowTop = top + height + 12;
                    const aboveTop = top - 12;
                    let cardTop = belowTop;
                    if (belowTop + card.offsetHeight > window.innerHeight - 8) {
                        cardTop = Math.max(8, aboveTop - card.offsetHeight);
                    }
                    const cardLeft = Math.min(window.innerWidth - cardWidth - 8, Math.max(8, left));

                    card.style.top = `${cardTop}px`;
                    card.style.left = `${cardLeft}px`;

                    stepEl.textContent = `AdÄ±m ${idx + 1} / ${steps.length}`;
                    titleEl.textContent = s.title;
                    textEl.textContent = s.text;

                    if (btnBack) btnBack.disabled = idx === 0;
                    if (btnNext) btnNext.textContent = idx === steps.length - 1 ? 'Bitir' : 'Ä°leri';
                }

                function open() {
                    tourRoot.classList.remove('hidden');
                    tourRoot.setAttribute('aria-hidden', 'false');
                    document.body.classList.add('overflow-hidden');
                    idx = 0;
                    place();
                }

                function next() {
                    if (idx >= steps.length - 1) {
                        finish();
                        return;
                    }
                    idx += 1;
                    place();
                }

                function back() {
                    if (idx <= 0) return;
                    idx -= 1;
                    place();
                }

                if (btnNext) btnNext.addEventListener('click', next);
                if (btnBack) btnBack.addEventListener('click', back);
                btnSkips.forEach((b) => b.addEventListener('click', finish));

                window.addEventListener('resize', () => {
                    if (!tourRoot.classList.contains('hidden')) place();
                });
                window.addEventListener('scroll', () => {
                    if (!tourRoot.classList.contains('hidden')) place();
                }, { passive: true });

                open();
            }

            openModal();
        })();
    </script>
    {% endif %}

    <script>
        (function initPollCountdown() {
            if (window.__pollCountdownInit) return;
            window.__pollCountdownInit = true;

            function formatCountdown(ms) {
                if (ms <= 0) return 'KapandÄ±';
                const totalSec = Math.floor(ms / 1000);
                const sec = totalSec % 60;
                const totalMin = Math.floor(totalSec / 60);
                const min = totalMin % 60;
                const totalHr = Math.floor(totalMin / 60);
                const hr = totalHr % 24;
                const day = Math.floor(totalHr / 24);

                if (day > 0) return `${day}g ${hr}s`;
                if (totalHr > 0) return `${hr}s ${min}dk`;
                return `${min}dk ${sec}sn`;
            }

            function updateCountdowns(root) {
                const scope = root || document;
                const els = scope.querySelectorAll('.poll-countdown[data-closes-at]');
                const now = Date.now();
                els.forEach((el) => {
                    const raw = el.getAttribute('data-closes-at') || '';
                    const t = Date.parse(raw);
                    if (!t) return;
                    const diff = t - now;
                    const txt = formatCountdown(diff);
                    const textEl = el.querySelector('.poll-countdown-text') || el;
                    const barInner = el.querySelector('.poll-countdown-bar-inner');
                    const durationSec = Number(el.getAttribute('data-duration-sec') || '');
                    const iconWrap = el.querySelector('.poll-countdown-icon');

                    function setState(state) {
                        el.setAttribute('data-state', state);
                        if (state === 'closed') {
                            el.classList.remove('text-[#666A73]', 'border-[#BFBFBF]');
                            el.classList.add('text-[#B33F00]', 'border-[#B33F00]/40');
                            if (iconWrap) {
                                iconWrap.classList.remove('bg-[#BFBFBF]/25', 'text-[#666A73]');
                                iconWrap.classList.add('bg-[#B33F00]/10', 'text-[#B33F00]');
                            }
                            if (barInner) {
                                barInner.classList.remove('from-[#0B5275]/65', 'to-[#666A73]/65');
                                barInner.classList.add('from-[#B33F00]/70', 'to-[#B33F00]/40');
                            }
                        } else {
                            el.classList.remove('text-[#B33F00]', 'border-[#B33F00]/40');
                            el.classList.add('text-[#666A73]', 'border-[#BFBFBF]');
                            if (iconWrap) {
                                iconWrap.classList.remove('bg-[#B33F00]/10', 'text-[#B33F00]');
                                iconWrap.classList.add('bg-[#BFBFBF]/25', 'text-[#666A73]');
                            }
                            if (barInner) {
                                barInner.classList.remove('from-[#B33F00]/70', 'to-[#B33F00]/40');
                                barInner.classList.add('from-[#0B5275]/65', 'to-[#666A73]/65');
                            }
                        }
                    }

                    if (txt === 'KapandÄ±') {
                        if (textEl) textEl.textContent = 'Anket kapandÄ±';
                        setState('closed');
                        if (barInner) {
                            barInner.style.width = '100%';
                            barInner.classList.remove('animate-pulse');
                        }
                    } else {
                        if (textEl) textEl.textContent = `KapanÄ±ÅŸ: ${txt}`;
                        setState('open');
                        if (barInner) {
                            if (!Number.isNaN(durationSec) && durationSec > 0) {
                                const start = t - durationSec * 1000;
                                const pct = Math.max(0, Math.min(1, (now - start) / (t - start)));
                                barInner.style.width = `${Math.round(pct * 100)}%`;
                                barInner.classList.remove('animate-pulse');
                            } else {
                                barInner.classList.add('animate-pulse');
                                barInner.style.width = '50%';
                            }
                        }
                    }
                });
            }

            function tick() {
                updateCountdowns(document);
            }

            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', tick);
            } else {
                tick();
            }
            setInterval(tick, 1000);
        })();
    </script>

    <script>
        // KaranlÄ±k / aydÄ±nlÄ±k tema deÄŸiÅŸtirme
        (function initThemeToggle() {
            const storageKey = 'bilemedilema-theme';
            const root = document.documentElement;
            const buttons = document.querySelectorAll('[data-theme-toggle]');
            const iconEls = document.querySelectorAll('[data-theme-icon]');
            const labelEls = document.querySelectorAll('[data-theme-label]');

            function applyTheme(theme, announce = false) {
                if (theme === 'dark') {
                    root.classList.add('dark');
                    buttons.forEach(btn => btn.setAttribute('aria-label', 'AydÄ±nlÄ±k moda dÃ¶n'));
                    iconEls.forEach(iconEl => iconEl.textContent = 'â˜€ï¸');
                    labelEls.forEach(labelEl => labelEl.textContent = 'AydÄ±nlÄ±k');
                } else {
                    root.classList.remove('dark');
                    buttons.forEach(btn => btn.setAttribute('aria-label', 'KaranlÄ±k modu aÃ§'));
                    iconEls.forEach(iconEl => iconEl.textContent = 'ðŸŒ™');
                    labelEls.forEach(labelEl => labelEl.textContent = 'KaranlÄ±k');
                }
                if (announce) localStorage.setItem(storageKey, theme);
            }

            function getInitialTheme() {
                const stored = localStorage.getItem(storageKey);
                if (stored === 'light' || stored === 'dark') return stored;
                return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
                    ? 'dark'
                    : 'light';
            }

            let currentTheme = getInitialTheme();
            applyTheme(currentTheme);

            buttons.forEach(btn => {
                btn.addEventListener('click', () => {
                    currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
                    applyTheme(currentTheme, true);
                });
            });
        })();
    </script>

    <!-- Service Worker Registration for PWA -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/static/sw.js')
                    .then((registration) => {
                        console.log('ServiceWorker registered:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('ServiceWorker registration failed:', error);
                    });
            });
        }
    </script>

    <!-- Image Lazy Loading -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const images = document.querySelectorAll('img[data-src]');
            
            const imageObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        img.src = img.dataset.src;
                        img.removeAttribute('data-src');
                        observer.unobserve(img);
                    }
                });
            });
            
            images.forEach(img => imageObserver.observe(img));
        });
    </script>

    <!-- Share functionality -->
    <script src="{% static 'js/share.js' %}"></script>
    
    <!-- Bookmark functionality -->
    <script src="{% static 'js/bookmarks.js' %}"></script>
    
    <!-- Mentions functionality -->
    <script src="{% static 'js/mentions.js' %}"></script>
    
    <!-- Simple Notifications (guaranteed to work) -->
    <script src="{% static 'js/notifications-simple.js' %}"></script>
    
    <!-- Comment Reactions -->
    <script src="{% static 'js/comment-reactions.js' %}"></script>
    
    <!-- Theme Switcher -->
    <script src="{% static 'js/theme-switcher.js' %}"></script>
    
    <!-- Share Image Generator -->
    <script src="{% static 'js/share-image-generator.js' %}"></script>
    
    <!-- Story Share -->
    <script src="{% static 'js/story-share.js' %}"></script>
    
    <!-- Poll Templates -->
    <script src="{% static 'js/poll-templates.js' %}"></script>
    
    <!-- Guest Vote CTA -->
    <script src="{% static 'js/guest-vote-cta.js' %}"></script>
    
    <!-- Poll Countdown -->
    <script src="{% static 'js/poll-countdown.js' %}"></script>
    
    <!-- Premium Animations -->
    <script src="{% static 'js/premium-animations.js' %}"></script>
    
    <!-- Lazy Loading & Performance -->
    <script src="{% static 'js/lazy-loading.js' %}"></script>
    
    <!-- Vote Animations -->
    <script src="{% static 'js/vote-animation.js' %}"></script>
    
    <!-- Badge Notifications -->
    <script src="{% static 'js/badge-notification.js' %}"></script>
    
    <!-- Emoji Picker -->
    <script src="{% static 'js/emoji-picker.js' %}"></script>
    
    <!-- Smart Search -->
    <script src="{% static 'js/smart-search.js' %}"></script>

    {% block extra_js %}{% endblock %}
</body>
</html>
